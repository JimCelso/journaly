<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Biografía</title>
  <link rel="stylesheet" href="pags.css"/>
</head>
<body>
  <a href="index.html" class="btn-regresar">⟵ Volver al Inicio</a>
  <h1>Biografía</h1>
  <div class="section-box">
    <p id="bioContent">Cargando biografía...</p>
    <button id="editarBio" style="margin-top:1rem;">Editar biografía</button>
  </div>

  <script type="module">
    import { auth } from './firebase-init.js';
    import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
    import { doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
    import { db } from './firebase-init.js';

    const bioContent = document.getElementById('bioContent');
    const editarBtn = document.getElementById('editarBio');

    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        window.location.href = 'login.html';
        return;
      }
      const snap = await getDoc(doc(db, 'users', user.uid));
      const profile = snap.exists() ? snap.data() : null;
      bioContent.textContent = profile && profile.bio ? profile.bio : "Aún no has escrito una biografía.";
    });

    editarBtn.addEventListener('click', async () => {
      const user = auth.currentUser;
      if (!user) return;
      const nueva = prompt('Escribe tu biografía:', bioContent.textContent === 'Aún no has escrito una biografía.' ? '' : bioContent.textContent);
      if (nueva === null) return;
      await setDoc(doc(db, 'users', user.uid), { bio: nueva }, { merge: true });
      bioContent.textContent = nueva;
    });
  </script>
</body>
</html>
